cmake_minimum_required(VERSION 3.2)

PROJECT(JumperBallThirdParty)

SET(CMAKE_INSTALL_PREFIX ${CMAKE_BINARY_DIR} CACHE PATH "" FORCE)

IF (NOT CMAKE_BUILD_TYPE OR CMAKE_BUILD_TYPE STREQUAL "")
	SET (CMAKE_BUILD_TYPE "Release" CACHE STRING "" FORCE)
ENDIF()


IF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
	SET(CMAKE_INSTALL_PREFIX ${CMAKE_BINARY_DIR} CACHE PATH "" FORCE)
ENDIF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)

SET(CMAKE_CXX_STANDARD 11)
SET(CMAKE_CXX_STANDARD_REQUIRED ON)
SET(CMAKE_CXX_EXTENSIONS OFF)


SET( LIST_LIBRARIES 
	"${CMAKE_INSTALL_PREFIX}/lib/${CMAKE_STATIC_LIBRARY_PREFIX}glfw3${CMAKE_STATIC_LIBRARY_SUFFIX}") 



INCLUDE(ExternalProject)
ExternalProject_Add( _GLFW_
  URL 		"https://github.com/glfw/glfw/archive/3.3.2.tar.gz"
  #SOURCE_DIR 	"${CMAKE_SOURCE_DIR}/libs/glfw-3.3.2"
  PREFIX 	GLFW_library	
  INSTALL_DIR	${CMAKE_INSTALL_PREFIX}
  CMAKE_ARGS 	-DGLFW_BUILD_DOCS=OFF 
  		-DGLFW_BUILD_TESTS=OFF
		-DGLFW_BUILD_EXAMPLES=OFF
		-DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}
		-DCMAKE_EXE_LINKER_FLAGS="${CMAKE_THREAD_LIBS_INIT} -lX11"
  BUILD_BYPRODUCTS ${LIST_LIBRARIES}
  TEST_COMMAND 	""
  )

  if(UNIX)
	  find_package(Threads REQUIRED)
	  find_package(X11 REQUIRED)
		
	  FOREACH ( X11_LIB X11_Xrandr X11_xf86vmode X11_Xcursor X11_Xinerama X11_Xinerama)
		
		  IF(NOT ${X11_LIB}_FOUND)
			  MESSAGE(FATAL_ERROR "${X11_LIB} library is required for GLFW but not found ...")
		  ENDIF()
	  ENDFOREACH(X11_LIB)

	  LIST(APPEND LIST_LIBRARIES
		  "${X11_Xrandr_LIB}" 
		  "${X11_Xxf86vm_LIB}"
		  "${X11_Xcursor_LIB}"
		  "${X11_Xinerama_LIB}"
		  "${X11_Xinput_LIB}"
		  "${CMAKE_THREAD_LIBS_INIT}" -lrt -ldl -lX11)
  ENDIF()

  set( GLFW_LIBRARIES ${LIST_LIBRARIES} CACHE STRING "") 
  
ExternalProject_Add( _GLM_
  URL 		"https://github.com/g-truc/glm/archive/0.9.9.0.tar.gz"
  #SOURCE_DIR 	"${CMAKE_SOURCE_DIR}/libs/glm-0.9.9.0"
  PREFIX 	GLM_library
  CMAKE_ARGS 	-DGLM_TEST_ENABLE=OFF
  		-DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}
  TEST_COMMAND 	""
  )

ADD_LIBRARY(${PROJECT_NAME} "glad/glad.c" "glad/glad.h" "glad/KHR/khrplatform.h")
ADD_DEPENDENCIES(${PROJECT_NAME} _GLFW_)
ADD_DEPENDENCIES(${PROJECT_NAME} _GLM_)
TARGET_LINK_LIBRARIES(${PROJECT_NAME} ${GLFW_LIBRARIES})
TARGET_INCLUDE_DIRECTORIES( ${PROJECT_NAME} PUBLIC glad/)
